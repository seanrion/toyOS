**在调试过很多次后，发现nasm的obj文件在调用C语言函数的时候函数地址出错，应是链接重定位出错了，在将nasm汇编格式改成elf32后，则正确重定位**

**书上的代码有误导，太坑爹了，**

```asm
	set_gatedesc(idt + 0x21, (int) asm_inthandler21-0x280000, 2 * 8, AR_INTGATE32);
	set_gatedesc(idt + 0x27, (int) asm_inthandler27-0x280000, 2 * 8, AR_INTGATE32);
	set_gatedesc(idt + 0x2c, (int) asm_inthandler2c-0x280000, 2 * 8, AR_INTGATE32);

```

**正确代码应该在这里设定idt表项偏移的时候要减掉一个0x280000，因为在gdt里的第二项本来就是以0x280000为基地址的，且该段的有效长度小，再加上一个0x280000的偏移会超出段的有效长度使得cpu进入保护机制，从而重启，这里太坑爹了，坑了我半天时间来调试。**

**但事后想想也不能怪作者，毕竟我没有用作者的工具链，而且我自己摸索了编译和链接部分的工作，这个问题出在我在链接时把装载地址设为了0x280000，大概作者的装载地址是直接从0开始的，那从现在得用gcc的位置无关选项编译链接了。况且自己没有逐条代码琢磨，出错也只能怪自己**

**之后发现位置无关需要文件格式和操作系统互相配合，只能先算了**