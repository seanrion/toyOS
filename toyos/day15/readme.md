任务状态段TSS结构:

![](img/2012033110185826.png)

当使用 call/jmp + TSS段选择子的时候，CPU做了以下几件事情。

- 把当前所有寄存器（TSS结构中有的那些寄存器）的值填写到当前 tr 段寄存器指向的 TSS 中
- 把新的 TSS 段选择子指向的段描述符加载到 tr 段寄存器中
- 把新的 TSS 段中的值覆盖到当前所有寄存器（TSS结构中有的那些寄存器）中

------

这次的第一个实验又陷入了之前弄中断门时候的死机问题，每次一进行段的跳转就会死机，好在这次我有了经验，知道这是cpu的保护机制，可能是在跳转的时候超出了段的有效长度，我检查了半天，终于检查出是任务b的tss结构里面eip设置错了，因为编译后链接地址设置为0x280000,因此要将任务b的地址减去一个0x280000，否则超出了gdt第二项的有效长度。

多任务是操作系统中很重要的一部分，作者设计的这个多任务机制用了tss来调节，不过主流操作系统虽然用到tss但却不用tss跳转的机制，因为这样开销很大，不过这个多任务机制确实稍微简单了点。